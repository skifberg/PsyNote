<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã - PsyNote</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-card {
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #f0e6ff 0%, #e6f0ff 100%);
        }
        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .option-btn {
            transition: all 0.2s ease;
        }
        .option-btn:hover {
            transform: scale(1.05);
            background: #4f46e5;
            color: white;
        }
        .option-btn.selected {
            background: #4f46e5;
            color: white;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-purple-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <a href="/" class="inline-block mb-6 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                ‚Üê –ù–∞ –≥–ª–∞–≤–Ω—É—é
            </a>
            <h1 class="text-4xl font-bold text-indigo-800 mb-4">üß† –ü—Å–∏—Ö–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã</h1>
            <p class="text-lg text-gray-600">–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏</p>
        </header>

        <!-- –í—ã–±–æ—Ä —Ç–µ—Å—Ç–∞ -->
        <div id="testSelection" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
            <div class="test-card bg-white rounded-xl shadow-lg p-6 border border-indigo-100">
                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üí≠</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">–≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç</h3>
                <p class="text-gray-600 mb-4">–û—Ü–µ–Ω–∫–∞ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å —ç–º–æ—Ü–∏—è–º–∏</p>
                <button onclick="startTest('eq_test')" class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition">
                    –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                </button>
            </div>

            <div class="test-card bg-white rounded-xl shadow-lg p-6 border border-indigo-100">
                <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <span class="text-2xl">üî•</span>
                </div>
                <h3 class="text-xl font-semibold text-gray-800 mb-2">–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –≤—ã–≥–æ—Ä–∞–Ω–∏—è</h3>
                <p class="text-gray-600 mb-4">–û—Ü–µ–Ω–∫–∞ —É—Ä–æ–≤–Ω—è –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏—Å—Ç–æ—â–µ–Ω–∏—è</p>
                <button onclick="startTest('burnout_test')" class="w-full px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition">
                    –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                </button>
            </div>
        </div>

        <!-- –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ -->
        <div id="testContainer" class="hidden max-w-2xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-8 mb-6">
                <h2 id="testName" class="text-2xl font-semibold text-gray-800 mb-2"></h2>
                <p id="testDescription" class="text-gray-600 mb-4"></p>
                
                <div class="flex items-center mb-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div id="progressBar" class="bg-indigo-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <span id="progressText" class="ml-4 text-sm text-gray-600">0/5</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-8">
                <h3 id="currentQuestion" class="text-xl font-semibold text-gray-800 mb-6"></h3>
                
                <div id="optionsContainer" class="grid grid-cols-5 gap-2 mb-6">
                    <!-- –û–ø—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>

                <div class="flex justify-between">
                    <button onclick="prevQuestion()" id="prevBtn" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition hidden">
                        ‚Üê –ù–∞–∑–∞–¥
                    </button>
                    <button onclick="nextQuestion()" id="nextBtn" class="px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition ml-auto">
                        –î–∞–ª–µ–µ ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div id="resultsContainer" class="hidden max-w-2xl mx-auto">
            <div class="bg-white rounded-xl shadow-lg p-8 text-center">
                <div class="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6">
                    <span class="text-3xl">üìä</span>
                </div>
                <h2 class="text-2xl font-semibold text-gray-800 mb-4">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>
                <div id="resultsContent"></div>
                <button onclick="resetTest()" class="mt-6 px-6 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition">
                    –ü—Ä–æ–π—Ç–∏ –¥—Ä—É–≥–æ–π —Ç–µ—Å—Ç
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTest = null;
        let currentQuestionIndex = 0;
        let answers = [];

        async function startTest(testId) {
            try {
                const response = await fetch(`/api/self-analysis/technique/psychometrics/${testId}`);
                currentTest = await response.json();
                
                document.getElementById('testSelection').classList.add('hidden');
                document.getElementById('testContainer').classList.remove('hidden');
                
                document.getElementById('testName').textContent = currentTest.name;
                document.getElementById('testDescription').textContent = currentTest.description;
                
                answers = new Array(currentTest.questions.length).fill(null);
                showQuestion(0);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–∞');
            }
        }

        function showQuestion(index) {
            currentQuestionIndex = index;
            const question = currentTest.questions[index];
            
            document.getElementById('currentQuestion').textContent = question;
            updateProgress();
            
            // –°–æ–∑–¥–∞–µ–º options –¥–ª—è Likert scale (1-5)
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            for (let i = 1; i <= 5; i++) {
                const optionBtn = document.createElement('button');
                optionBtn.className = `option-btn p-3 rounded-lg border border-gray-300 text-sm ${
                    answers[index] === i ? 'selected' : ''
                }`;
                optionBtn.textContent = i;
                optionBtn.onclick = () => selectOption(i);
                optionsContainer.appendChild(optionBtn);
            }
            
            // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            document.getElementById('prevBtn').classList.toggle('hidden', index === 0);
            document.getElementById('nextBtn').textContent = index === currentTest.questions.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ ‚Üí';
        }

        function selectOption(value) {
            answers[currentQuestionIndex] = value;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º visual feedback
            const options = document.querySelectorAll('.option-btn');
            options.forEach((btn, index) => {
                btn.classList.toggle('selected', index + 1 === value);
            });
        }

        function nextQuestion() {
            if (answers[currentQuestionIndex] === null) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ—Ç–≤–µ—Ç');
                return;
            }
            
            if (currentQuestionIndex < currentTest.questions.length - 1) {
                showQuestion(currentQuestionIndex + 1);
            } else {
                showResults();
            }
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                showQuestion(currentQuestionIndex - 1);
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentTest.questions.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${currentQuestionIndex + 1}/${currentTest.questions.length}`;
        }

        function showResults() {
            const totalScore = answers.reduce((sum, answer) => sum + answer, 0);
            const maxScore = currentTest.questions.length * 5;
            const percentage = (totalScore / maxScore) * 100;
            
            document.getElementById('testContainer').classList.add('hidden');
            document.getElementById('resultsContainer').classList.remove('hidden');
            
            document.getElementById('resultsContent').innerHTML = `
                <p class="text-lg text-gray-700 mb-4">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <strong>${totalScore}/${maxScore}</strong></p>
                <div class="w-full bg-gray-200 rounded-full h-4 mb-6">
                    <div class="bg-indigo-600 h-4 rounded-full transition-all duration-1000" style="width: ${percentage}%"></div>
                </div>
                <p class="text-gray-600 mb-4">${getInterpretation(currentTest.id, percentage)}</p>
            `;
        }

        function getInterpretation(testId, percentage) {
            const interpretations = {
                'eq_test': {
                    high: '–û—Ç–ª–∏—á–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞! –í—ã —Ö–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç–µ —ç–º–æ—Ü–∏—è–º–∏.',
                    medium: '–•–æ—Ä–æ—à–∏–π —É—Ä–æ–≤–µ–Ω—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –ï—Å—Ç—å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è.',
                    low: '–ï—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –æ—Å–æ–∑–Ω–∞–Ω–Ω–æ—Å—Ç–∏.'
                },
                'burnout_test': {
                    high: '–ù–∏–∑–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –í—ã —Ö–æ—Ä–æ—à–æ —Å–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å —Å –Ω–∞–≥—Ä—É–∑–∫–∞–º–∏.',
                    medium: '–£–º–µ—Ä–µ–Ω–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–±—Ä–∞—Ç–∏—Ç—å –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ self-care.',
                    low: '–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –≤—ã–≥–æ—Ä–∞–Ω–∏—è. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–¥—ã—Ö –∏ –ø–µ—Ä–µ—Å–º–æ—Ç—Ä workload.'
                }
            };
            
            if (percentage >= 70) return testId === 'burnout_test' ? interpretations[testId].high : interpretations[testId].low;
            if (percentage >= 40) return interpretations[testId].medium;
            return testId === 'burnout_test' ? interpretations[testId].low : interpretations[testId].high;
        }

        function resetTest() {
            document.getElementById('resultsContainer').classList.add('hidden');
            document.getElementById('testSelection').classList.remove('hidden');
            currentTest = null;
            answers = [];
        }
    </script>
</body>
</html>